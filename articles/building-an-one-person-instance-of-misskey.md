---
title: "Misskeyのおひとり様インスタンスを建てる"
emoji: "🌱"
type: "tech"
topics: [misskey]
published: false
---

# 初めに

先日旧TwitterことXにて、私の投稿が他の人から見えないいわゆるシャドウバン状態になってしまいました。
その普及率の高さゆえにXから逃れることは難しいですが、安心と安全のために自分の管理下にあるSNSも欲しいな...と思い立ちMisskeyインスタンスを建てることにしました。
元々Misskey.ioのアカウントは持っていたのですが、どうせ分散型SNSを利用するなら自分のインスタンスを持ってリレーに参加したい...という願望があったのも一因です。
当記事は今回作った[しぜすきー](https://mi.see2et.dev)の構築の様子の備忘録です。

## 用意したもの

- Misskeyを実行するためのVPS: Vultr
- 独自ドメイン: Cloudflare Registrar
- DNS: Cloudflare
- オブジェクトストレージ: Cloudflare R2

### VPSの構成

今回はVultrというサービスのサーバを借りることにしました。
スペックは下記の通りです。

| 項目 | 内容 |
| ---- | ---- |
| Server | Cloud Compute |
| Region | Tokyo |
| CPU | 1 |
| RAM | 1024MB |
| Storage | 25GB |
| OS | Ubuntu 22.04 x64 |

デフォルトで付与されているAuto Backupsオプションをオフにすれば、月額5ドルで利用できるみたいです。(2023年9月30日現在)

### ドメインとDNS

Fediverseにおいてドメインは@example@example.comのようにユーザ名の一部になるため、独自ドメインを使用することをお勧めします。
以前にCloudflare Registrarを利用してドメインを取得していたので、今回はそのサブドメインを利用することにしました。
連携が便利で情報が豊富なため、DNSもCloudflareのものを利用しました。

### オブジェクトストレージ

「10GB/月まで無料」「データのアクセスにお金はかからないぜ！」というお得な料金体系であるCloudflare R2を利用します。
オブジェクトストレージを利用しなくてもMisskeyインスタンスを運用することができますが、画像やカスタム絵文字を利用することはできません。

## ssh接続と環境構築

以下の記事の`# 作業マシンのsshの準備`から`# VultrのIPv6アドレスを有効にする`を参考に進めました。
[Misskeyのサーバを設置する](https://blog.noellabo.jp/entry/2019/08/14/8i3RHuZ1wJNDinIn)

## Misskeyのインストール

Misskeyのインストールには様々な方法がありますが、公式が用意している以下のシェルスクリプトが一番簡単かつ素早くできるかと思います。
いくつかオプションがありますが、私はDocker Hubを利用する方法を選択しました。

[Misskey install shell script v3.0.0](https://misskey-hub.net/docs/install/bash.html)

### 注意

実行する前に必ずCloudflareでドメインの設定を完了しましょう。
深夜帯に作業していたため寝ぼけていた私はこれで一度やらかしました。

## CDNの設定

CDNを利用することで静的なコンテンツをキャッシュしサーバーの負荷を抑えることができます。
ただしMisskeyのAPIをキャッシュしてはいけないので、`/api/*`をキャッシュしないようにしましょう。
Cloudflareを利用している場合、Cache Rulesにて設定できます。

[CDNの設定 | Misskey Hub](https://misskey-hub.net/docs/admin/cdn.html)

## オブジェクトストレージの設定

以下の記事を参考に進めました。
[misskeyのオブジェクトストレージにcloudflare r2を利用する](https://qiita.com/hihumikan/items/1f692f3bd5516820e0ec)

### 注意

Misskeyの`コントロールパネル/設定/全般`から`リモートのファイルをキャッシュする`をオフにすることをお勧めしておきます。
オフにしない場合、大量のファイルがオブジェクトストレージに保存され無料枠を圧迫する要因となってしまいます。

## off-topic

ここまで完了していれば、Misskeyインスタンスとしての利用ができると思います。
より楽しいMisskeyライフを送るために参考になりそうなことを記載しておきます。

### カスタム絵文字を外部インスタンスからインポート

Misskeyのサイドバーから`もっと！/情報/サーバー情報/カスタム絵文字/カスタム絵文字の管理/リモート`と進むと、あなたのインスタンスに表示された外部インスタンスのカスタム絵文字一覧が表示されます。
好きなものをクリックしインポートボタンを押せば、あなたのインスタンスですぐに同じ絵文字を利用することができます！

### リレーの追加

インスタンスを作成しただけだとあなたのインスタンスはこのFediverseの宇宙でまだひとりぼっちです。
`コントロールパネル/リレー`からお好きなリレーサーバーを追加して、さまざまなインスタンスと繋がりましょう。
以下のページにFediverseのリレーサーバーがまとめられているので、参考にしてみてもいいでしょう。

[Fediverseリレーサーバー一覧2023（for Mastodon / Misskey / Pleroma）
2022/06/07](https://hisubway.online/blog/fediverse_relay/)

### デフォルトテーマのカスタマイズ

初期状態のテーマはMisskey.ioなどでお馴染みのものですが、せっかくであればあなた好みの色にカスタマイズするのも良いかもしれません。
`コントロールパネル/ブランディング/`でサーバーデフォルトのテーマをいじることができます。
私は`設定/テーマ/テーマの管理`からMi U0 Light/Darkのテーマコードをコピーして利用しています。

[テーマ | Misskey Hub](https://misskey-hub.net/docs/features/theme.html)

## 最後に

ここまで読んでいただきありがとうございました。
Misskeyインスタンス構築の一助になれば幸いです！
