---
title: "[home-manager] codexãŒError: Permission denied (os error 13)ã‚’åãå•é¡Œã¸ã®å¯¾å‡¦æ³•"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nix", "codex"]
published: false
---

## TL;DR
Nixã®[home-manager](https://github.com/nix-community/home-manager)ã‚’ç”¨ã„ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ç’°å¢ƒã¸ç§»è¡Œã—ã¦ã„ãŸã¨ã“ã‚ã€codexãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’`home.file`ã§é…ç½®ã™ã‚‹ã¨ã€èª­ã¿å–ã‚Šå°‚ç”¨ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚codex ã¯`~/.codex`ã«æ›¸ãè¾¼ã¿ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚`Error: Permission denied (os error 13)`ãŒå‡ºã¾ã—ãŸã€‚ã€Œå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’`home.file`ã§é…ç½®ã™ã‚‹ã€ã“ã¨ã§å¯¾å‡¦ã—ã¾ã—ãŸã€‚

## æ¤œè¨¼ç’°å¢ƒ
- Windows 11 Home
- WSL2
    - Ubuntu 24.04.3 LTS
- nix 2.31.2
- home-manager 25.11-pre
- codex-cli 0.42.0

## èµ·ãã¦ã„ãŸå•é¡Œ

home-managerã§ã¯ã€å®£è¨€çš„ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ãã‚Œã«å€£ã„ã€codexã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
```nix:home.nix
{config, pkgs}: {
    ...
    home.packages = pkgs; [
        neovim
        zsh
        ...
        codex
    ]
    ...
}
```
```zsh:zsh
// home.nixã®å¤‰æ›´ã‚’åæ˜ ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
$ home-manager switch
```

ã—ã‹ã—ã€codexã‚’æ­£å¸¸ã«å‹•ä½œã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã§ã—ãŸã€‚
```zsh:zsh
$ codex
Error: Permission denied (os error 13)
```

## å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘
ã¾ãšã€`codex`ã‚³ãƒãƒ³ãƒ‰ãã‚Œè‡ªä½“ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ãªã„ã®ã‹ã€ãã‚Œä»¥å¤–ã®read/writeãŒå¿…è¦ãªå ´é¢ã§è©°ã¾ã£ã¦ã„ã‚‹ã®ã‹ã‚’åˆ‡ã‚Šåˆ†ã‘ã¾ã™ã€‚å¹¸ã‹ä¸å¹¸ã‹`codex --help`ã¯æ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸã€‚
```zsh:zsh
$ codex --help
Codex CLI

If no subcommand is specified, options will be forwarded to the interactive CLI.

Usage: codex [OPTIONS] [PROMPT]
       codex [OPTIONS] [PROMPT] <COMMAND>
...
```

codexã¯`~/.codex`é…ä¸‹ã«ãƒ­ã‚°ç­‰ã‚’èª­ã¿æ›¸ãã™ã‚‹ã®ã§ã€ã“ã“ã®æ¨©é™ä¸è¶³ã‚’ç–‘ã„ã¾ã™ã€‚ã©ã†ã‚„ã‚‰ã€æ›¸ãè¾¼ã¿ãŒç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```zsh:zsh
$ cd ~/.codex
$ lsd -la
dr-xr-xr-x   2 see2et see2et 4.0K Jan  1  1970 .
drwxr-xr-x 517 see2et see2et 356K Oct  1 04:53 ..
-r--r--r--   1 see2et see2et  145 Jan  1  1970 AGENTS.md
-r--r--r--   1 see2et see2et  504 Jan  1  1970 config.toml
-r--r--r--   1 see2et see2et  395 Jan  1  1970 github-mcp.sh
```

`chmod 700 .`ã¨ã‹ã§æ¨©é™ã‚’ä¸ãˆã¦ã‚‚ã„ã„ã®ã§ã™ãŒ......ã“ã‚Œã¯ã€å®£è¨€çš„ã«ãªã‚‹ã¹ãå…¨ã¦ã‚’æ‰±ã„ãŸã„Nixã®æ€æƒ³ã«åã™ã‚‹ã®ã§ã€ãŠä½œæ³•çš„ã«é¿ã‘ãŸã„ã¨ã“ã‚ã§ã™ã€‚ãªã®ã§ã€æ ¹æœ¬çš„ãªåŸå› ã‚’è§£æ±ºã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## åŸå› ã®æ­£ä½“
`~/.codex`ãŒreadonlyã«ãªã£ã¦ã„ãŸåŸå› ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«codexã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã—ã¦ã„ãŸã“ã¨ã«ã‚ã‚Šã¾ã—ãŸã€‚ã“ã®è¨­å®šã«ã‚ˆã‚Šã€`home-manager switch`å®Ÿè¡Œæ™‚ã«`~/.config/home-manager/codex`ã¯`~/.codex`ã«è‡ªå‹•ã§é…ç½®ã•ã‚Œã¾ã™ã€‚
```nix:home.nix
{config, pkgs}: {
    home.file = {
        ".config/nvim".source = ./nvim;
        ".config/zellij".source = ./zellij;
        ...
        ".codex".source = ./codex;
    };
}
```
ã“ã®ã¨ãã€home-managerã¯ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’readonlyã§é…ç½®ã™ã‚‹ã‚ˆã†ã§ã™ã€‚ãã“ã§ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’home-managerã§é…ç½®ã™ã‚‹ã“ã¨ã§ã€ã“ã®å•é¡Œã‚’è§£æ±ºã—ã¾ã—ãŸã€‚
```diff:home.nix
{config, pkgs}: {
    home.file = {
        ".config/nvim".source = ./nvim;
        ".config/zellij".source = ./zellij;
        ...
-   ".codex".source = ./codex;

+   # å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’é…ã‚‹ï¼ˆè¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯å®Ÿä½“ã¨ã—ã¦ä½œã‚‰ã‚Œã‚‹ï¼‰
+   ".codex/config.toml".source = ./codex/config.toml;
+   ".codex/AGENTS.md".source = ./codex/AGENTS.md;
+   ".codex/github-mcp.sh" = {
+       source = ./codex/github-mcp.sh;
+       executable = true;
+   };
}
```

ç„¡äº‹ã€`$ codex`ã§ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ãã¡ã‚“ã¨writeæ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚`sessions` `log`ãªã©ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚‚æ­£å¸¸ã«ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```zsh:zsh
$ lsd -la
drwx------ see2et see2et 4.0 KB Wed Oct  1 16:49:10 2025 ï„• .
drwxr-x--- see2et see2et 4.0 KB Wed Oct  1 16:54:53 2025 ï„• ..
lrwxrwxrwx see2et see2et  79 B  Wed Oct  1 16:43:45 2025 ï’ AGENTS.md â‡’ /nix/store/z34866j787zlxab15w7b5sima0wcr7ld-home-manager-files/.codex/AGENTS.md
lrwxrwxrwx see2et see2et  81 B  Wed Oct  1 16:43:45 2025 ï’ config.toml â‡’ /nix/store/z34866j787zlxab15w7b5sima0wcr7ld-home-manager-files/.codex/config.toml
lrwxrwxrwx see2et see2et  83 B  Wed Oct  1 16:43:45 2025 ï’ github-mcp.sh â‡’ /nix/store/z34866j787zlxab15w7b5sima0wcr7ld-home-manager-files/.codex/github-mcp.sh
drwxr-xr-x see2et see2et 4.0 KB Wed Oct  1 16:48:41 2025 ï„• log
drwxr-xr-x see2et see2et 4.0 KB Wed Oct  1 16:49:10 2025 ï„• sessions
.rw-r--r-- see2et see2et  79 B  Wed Oct  1 16:48:42 2025 î˜‹ version.json
```
